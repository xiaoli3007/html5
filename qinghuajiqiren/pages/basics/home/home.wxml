<wxs module="util">

    var sub = function(val) {

        return val.substring(0, 60)+"..."

    }

    module.exports.sub = sub;

</wxs>
<view id='top_main'>
<cu-custom bgColor="bg-gradual-blue">
  <view slot="content">诗小图</view>
</cu-custom>

<view class="cu-bar bg-blue  solid-bottom cu-bar-title">
  <view class="action">
    <text class="cuIcon-title text-white "></text> 相关知识
  </view>
</view>

    <view class="flex  p-xs  mb-sm" wx:if='{{person_desc}}'>
      <view class="bg-grey padding-sm margin-xs radius">     
       <view class="fl"> {{util.sub(person_desc)}} </view>
        <view class="text-yellow fr" bindtap="showModal" data-target="Modal"> 更多</view>     
      </view> 
    </view>

    <view class="cu-modal {{modalName=='Modal'?'show':''}}">
  <view class="cu-dialog">
    <view class="cu-bar bg-white justify-end">
      <view class="content">{{person_name}}</view>
      <view class="action" bindtap="hideModal">
        <text class="cuIcon-close text-red"></text>
      </view>
    </view>

    <scroll-view scroll-y  style="height:{{scrollheight}}px">
    <view class="padding-xl text-left">
   {{person_desc}}
    </view>
</scroll-view>

  </view>
</view>


<view class="flex flex-wrap">
 <block wx:key wx:for='{{relList}}' wx:for-index="index" wx:if='{{index<5}}'>
  <view class="padding-xs">
    <view class="cu-tag bg-blue light " bindtap="btnsendmsg" data-val="{{item.name}}">{{item.name}}    </view>
  </view>
  </block>

  <view class="padding-xs" wx:if='{{relList[0].name}}'>
    <view class="cu-tag bg-orange " bindtap="gotoPage1">生成图谱</view>
  </view>

</view>

 
<view class="cu-bar bg-blue   solid-bottom cu-bar-title">
  <view class="action">
    <text class="cuIcon-title text-white "></text> 聊天
  </view>
</view>

</view>

<scroll-view scroll-y class="flex flex-wrap" bindscrolltoupper="upper" bindscrolltolower="lower" bindscroll="scroll" scroll-into-view="{{toView}}" style="height:{{scrollheight}}px">
  <view class="cu-chat">

    <block wx:key wx:for='{{msgList}}' wx:for-index="index">

      <view class="cu-item self" wx:if='{{item.speaker=="self"}}' id='msg-{{index}}'>
        <view class="main">
          <view class="content bg-green shadow">
            {{item.content}}
          </view>
        </view>
        <view class="cu-avatar radius" wx:if='{{hasUserInfo}}' style="background-image:url({{userInfo.avatarUrl}});"></view>

        <view class="cu-avatar radius" wx:if='{{!hasUserInfo}}'>
          <text class="cuIcon-people"></text>
        </view>

        <view class="date">{{item.time}}</view>
      </view>

      <view class="cu-item" wx:if='{{item.speaker=="server"}}' id='msg-{{index}}'>
        <view class="cu-avatar radius shixiaotu-bg"></view>
        <view class="main">
          <view class="content shadow">
            {{item.content}}
          </view>
        </view>
        <view class="date">{{item.time}}</view>
      </view>


    </block>




  </view>

</scroll-view>

<view id='foot' class="cu-bar foot input {{InputBottom!=0?'cur':''}}" style="bottom:{{InputBottom}}px">

  <input class="solid-bottom" bindfocus="InputFocus" bindblur="InputBlur" adjust-position="{{false}}" focus="{{false}}" maxlength="300" cursor-spacing="10" bindinput="bindKeyInput" value='{{msgdata}}'></input>

  <button class="cu-btn bg-green shadow" bindtap="sendmsg" disabled="{{Inputdisabled}}">发送</button>
</view>